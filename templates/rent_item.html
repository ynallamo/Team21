{% extends "base.html" %}

{% block title %}Rent an Item{% endblock %}

{% block content %}
<h1>Rent an Item</h1>

<!-- Selection box to choose between viewing resources or community spaces -->
<div class="form-group">
    <label for="rentType">Choose an item type to rent:</label>
    <select class="form-control" id="rentType" onchange="showAvailableItems()">
        <option value="">-- Select an Option --</option>
        <option value="resource">Resources</option>
        <option value="community">Community Spaces</option>
    </select>
</div>

<!-- Container for displaying available resources -->
<div id="resourcesList" style="display: none;">
    <h3>Available Resources</h3>
    <div class="row">
        {% for resource in resources %}
        <div class="col-md-6 col-lg-4 mb-4">
            <!-- Card for each resource -->
            <div class="card" onclick="location.href='{{ url_for('item_details', item_id=resource['resource_id']) }}'" style="cursor: pointer;">
                <!-- Check if 'images' exists; if not, use 'images/default.jpg' as fallback -->
                <img src="{{ url_for('static', filename=resource['images'] if resource['images'] else 'images/default.jpg') }}" class="card-img-top" alt="Resource image">
                <div class="card-body">
                    <h6 class="card-title">{{ resource['title'] }}</h6>
                    <p class="card-text small">{{ resource['description'] }}</p>
                    <p class="mb-0">
                        <strong>Category:</strong> {{ resource['category'] }}
                    </p>
                    <p>
                        {% if resource['availability'] == 'unavailable' %}
                            <span class="text-danger">Currently Reserved</span>
                        {% else %}
                            <span class="text-success">Available</span>
                        {% endif %}
                    </p>
                </div>
            </div>
        </div>
        {% endfor %}
    </div>
    <!-- Pagination -->
    <nav aria-label="Resource pagination">
        <ul class="pagination justify-content-center">
            {% if resources_has_prev %}
                <li class="page-item">
                    <a class="page-link" href="{{ url_for('rent_item', type='resource', page=resources_prev_page) }}" aria-label="Previous">
                        <span aria-hidden="true">&laquo;</span>
                    </a>
                </li>
            {% endif %}
            {% for page in resources_pages %}
                <li class="page-item {% if page == resources_current_page %}active{% endif %}">
                    <a class="page-link" href="{{ url_for('rent_item', type='resource', page=page) }}">{{ page }}</a>
                </li>
            {% endfor %}
            {% if resources_has_next %}
                <li class="page-item">
                    <a class="page-link" href="{{ url_for('rent_item', type='resource', page=resources_next_page) }}" aria-label="Next">
                        <span aria-hidden="true">&raquo;</span>
                    </a>
                </li>
            {% endif %}
        </ul>
    </nav>
</div>

<!-- Container for displaying available community spaces -->
<div id="communityList" style="display: none;">
    <h3>Available Community Spaces</h3>
    <div class="row">
        {% for community in community_spaces %}
        <div class="col-md-6 col-lg-4 mb-4">
            <!-- Card for each community space -->
            <div class="card" onclick="location.href='{{ url_for('item_details', item_id=community['community_id']) }}'" style="cursor: pointer;">
                <!-- Check if 'images' exists; if not, use 'images/default.jpg' as fallback -->
                <img src="{{ url_for('static', filename=community['images'] if community['images'] else 'images/default.jpg') }}" class="card-img-top" alt="Community space image">
                <div class="card-body">
                    <h6 class="card-title">{{ community['title'] }}</h6>
                    <p class="card-text small">{{ community['description'] }}</p>
                    <p class="mb-0">
                        <strong>Location:</strong> {{ community['location'] }}
                    </p>
                    <p>
                        {% if community['availability'] == 'unavailable' %}
                            <span class="text-danger">Currently Reserved</span>
                        {% else %}
                            <span class="text-success">Available</span>
                        {% endif %}
                    </p>
                </div>
            </div>
        </div>
        {% endfor %}
    </div>
    <!-- Pagination -->
    <nav aria-label="Community pagination">
        <ul class="pagination justify-content-center">
            {% if community_has_prev %}
                <li class="page-item">
                    <a class="page-link" href="{{ url_for('rent_item', type='community', page=community_prev_page) }}" aria-label="Previous">
                        <span aria-hidden="true">&laquo;</span>
                    </a>
                </li>
            {% endif %}
            {% for page in community_pages %}
                <li class="page-item {% if page == community_current_page %}active{% endif %}">
                    <a class="page-link" href="{{ url_for('rent_item', type='community', page=page) }}">{{ page }}</a>
                </li>
            {% endfor %}
            {% if community_has_next %}
                <li class="page-item">
                    <a class="page-link" href="{{ url_for('rent_item', type='community', page=community_next_page) }}" aria-label="Next">
                        <span aria-hidden="true">&raquo;</span>
                    </a>
                </li>
            {% endif %}
        </ul>
    </nav>
</div>

<!-- JavaScript to toggle between resource and community lists -->
<script>
    function showAvailableItems() {
        const rentType = document.getElementById("rentType").value;
        const resourcesList = document.getElementById("resourcesList");
        const communityList = document.getElementById("communityList");

        // Hide both lists initially
        resourcesList.style.display = "none";
        communityList.style.display = "none";

        // Show the selected list
        if (rentType === "resource") {
            resourcesList.style.display = "block";
        } else if (rentType === "community") {
            communityList.style.display = "block";
        }
    }
</script>
{% endblock %}
