{% extends "base.html" %}

{% block title %}{{ item.title }} Details{% endblock %}

{% block content %}
<h1>{{ item.title }}</h1>

<!-- Item Details Section -->
<div class="card" style="max-width: 600px; margin: auto;">
    <img src="{{ url_for('static', filename=item['images']) }}" class="card-img-top" alt="Item image" style="width: 100%; height: auto; max-height: 300px; object-fit: cover;">
    <div class="card-body">
        <p>{{ item.description }}</p>
        {% if item_type == 'resource' %}
            <p>Category: {{ item['category'] }}</p>
        {% elif item_type == 'community' %}
            <p>Location: {{ item['location'] }}</p>
        {% endif %}
        <p>Availability: {{ item['availability'] }}</p>
    </div>
</div>

<!-- Owner Details Section -->
<div class="mt-4">
    <h3>Owner: {{ owner['name'] if owner['user_id'] else "Unknown" }}</h3>
    <p>Location: {{ owner['location'] if owner['user_id'] else "N/A" }}</p>
    <p>Rating: {{ average_rating if average_rating else 'No ratings yet' }}</p>
</div>

<!-- Reviews Section -->
<div class="mt-4">
    <h3>Reviews</h3>
    {% if reviews and owner['user_id'] %}
        <ul class="list-group">
            {% for review in reviews %}
                <li class="list-group-item">
                    <strong>Rating:</strong> {{ review['rating'] }} / 5
                    <p>{{ review['comment'] }}</p>
                    <small>Posted on {{ review['timestamp'] }}</small>
                </li>
            {% endfor %}
        </ul>
    {% else %}
        <p>No reviews yet.</p>
    {% endif %}
</div>

<!-- Reservation Calendar Section -->
<div class="mt-4">
    <h3>Reserve This Item</h3>
    <p>Select a date to reserve this item:</p>
    <form method="POST" action="{{ url_for('reserve_item', item_id=item['resource_id'] if item_type == 'resource' else item['community_id']) }}">
        <div class="form-group">
            <label for="reservation_date">Reservation Date:</label>
            <input type="date" class="form-control" id="reservation_date" name="reservation_date" required>
        </div>
        <button type="submit" class="btn btn-success mt-2">Reserve</button>
    </form>
</div>

<!-- Messaging Section -->
{% if owner['user_id'] %}
<div class="mt-4">
    <h3>Message the Owner</h3>
    <form method="POST" action="{{ url_for('send_message', receiver_id=owner['user_id']) }}">
        <div class="form-group">
            <textarea class="form-control" name="message_content" rows="3" placeholder="Write your message..." required></textarea>
        </div>
        <button type="submit" class="btn btn-primary">Send Message</button>
    </form>
</div>
{% else %}
<p class="text-muted">Messaging not available as the owner is unknown.</p>
{% endif %}
{% endblock %}
